require("evtools")
require("devtools")
?Roxygen2
library(weboflife)
library(weboflife)
all_networks <- get_networks(interaction_type = "all", data_type = "all")
rm(list=ls())
#devtools::install_github("mabarbour/weboflife", force=TRUE) # already installed
library(weboflife)
# download all networks from the Web of Life
networks <- get_networks(interaction_type = "pollination", data_type = "all")
# get metadata for each network, including latitude, longitude, and nonrarefied number of species, links, and connectance
network_info <- get_network_info(interaction_type = "pollination", data_type = "all")
# let's look at our networks
network_info
network_info
network_info <- get_network_info(interaction_type = "pollination", data_type = "all")
pacman::p_load("plyr","tidyverse", "cowplot", "bipartite", "devtools", "jsonlite", "data.table", "assertthat","plotly")
# Matt
#devtools::install_github("mabarbour/weboflife", force=TRUE) # already installed
library(weboflife)
# download all networks from the Web of Life
networks <- get_networks(interaction_type = "pollination", data_type = "all")
# get metadata for each network, including latitude, longitude, and nonrarefied number of species, links, and connectance
network_info <- get_network_info(interaction_type = "pollination", data_type = "all")
# let's look at our networks
network_info
class(networks)
dim(networks)
length(networks)
networks[1]
length(networks[1])
library(learnr)
library("tidyverse")
library("rjson")
library("data.table")
library("bipartite")
library("repr")
library(knitr)
knitr::opts_chunk$set(echo = FALSE)
setwd("~/ecological_networks_2020/12_march@vindigni/")
# type of interactions
# mutualistic
# "3" (plant-ant)
# "5" (plant-pollinator)
# "6" (plant-seed disperser)
# "11" (anemone-fish)
# antagonistic
# "8" (host-parasite)
# "10" (plant-herbivore)
# "7" (food webs)
# we might need to express it as an absolute path in the future
path_to_networks_data = "~/ecological_networks_2020/12_march@vindigni/Networks_data/"
source('~/ecological_networks_2020/12_march@vindigni/download_networks.R')
# # ---- plant-seed -----
# network_list <- list()
# network_list = download_network_web_of_life(network_list, 6)
# save(network_list,file = paste0(path_to_networks_dat  a, "network_list.RData"))
#
# # ---- plant-pollinator ----
# network_list_PL <- list()
# network_list_PL = download_network_web_of_life(network_list_PL, 5)
# save(network_list_PL,file = paste0(path_to_networks_data, "network_list_PL.RData"))
#
# # ---- host-parasite ----
# network_list_HP <- list()
# network_list_HP = download_network_web_of_life(network_list_HP, 8)
# save(network_list_HP,file = paste0(path_to_networks_data, "network_list_HP.RData"))
#
# # ---- all networks ----
# all_networks <- list()
# # type = 0 => download all available networks
# all_networks = download_network_web_of_life(all_networks, 0)
# save(all_networks,file = paste0(path_to_networks_data, "all_networks.RData"))
url <- paste("http://www.web-of-life.es/download/",
networkName,
"_",
speciesName,
".csv",
sep = "")
networkName <- "M_SD_002"
speciesName <- "yes"
url <- paste("http://www.web-of-life.es/download/",
networkName,
"_",
speciesName,
".csv",
sep = "")
url
setwd("~/ecological_networks_2020/12_march@vindigni")
type_id = 5
json_file <- paste("http://www.web-of-life.es/networkslist.php?type=",
type_id,
"&data=All",
sep = "")
json_file
url
#' Get networks from Web of Life
#'
#' @param interaction_type "all", "plant-ant", "pollination", "seed disperser", "plant-herbivore", "anemone-fish", "host-parasite", "food web"
#' @param data_type "binary", "weighted", or "all"
#' @param names would you like to include the names of species? default = "yes", otherwise input "no"
#' @return list of networks
#' @seealso
#' @export
#' @examples
get_networks <- function(networkName, interaction_type, data_type, names = "yes"){
# would you like to include the names of the species? ("yes" or "no")
speciesName <- names
if (missing(networkName)){
# create an empty list to store the networks
network_list <- list()
# nested ifelse statement to turn interaction types into codes for Web of Life
type_id <- ifelse(interaction_type == "plant-ant", "3",
ifelse(interaction_type == "pollination", "5",
ifelse(interaction_type == "seed disperser", "6",
ifelse(interaction_type == "anemone-fish", "11",
ifelse(interaction_type == "host-parasite", "8",
ifelse(interaction_type == "plant-herbivore", "10",
ifelse(interaction_type == "food web", "7",
ifelse(interaction_type == "all", "All", NA))))))))
data_id <- ifelse(data_type == "binary", "0",
ifelse(data_type == "weighted", "1",
ifelse(data_type == "all", "All", NA)))
# create a file (json_networks) with the names of the networks we would like to download
json_file <- paste("http://www.web-of-life.es/networkslist.php?type=",
type_id, "&data=", data_id, sep = "")
json_networks <- rjson::fromJSON(file = json_file) #rjson::fromJSON(paste(readLines(json_file), collapse = ""))
# download the networks
#network_list <- list()
for(i in 1: length(json_networks)){
# identifying the network
#if(as.numeric(json_networks[[i]]$countSpecies) > 0) { # we get networks and subnetworks
if(json_networks[[i]]$root == 0 & is.null(json_networks[[i]]$parentNetworkId)){ # we get networks without subnetworks
networkName <- json_networks[[i]]$networkName
print(networkName)
# building the URL
url <- paste("http://www.web-of-life.es/download/",
networkName,
"_",
speciesName, ".csv",
sep = "")
# download the network from www.web-of-life.es
data <- data.table::fread(url)
# storing the networks as a data table
assign(networkName, data)
# storing the networks as a list
network_list[[networkName]] <- (data)
}
#}
}
return(network_list)
}
else  # networkName passed as an argument
{
url <- paste("http://www.web-of-life.es/download/",
networkName,
"_",
speciesName,
".csv",
sep = "")
# download the requested network from www.web-of-life.es
data <- data.table::fread(url)
return (data)
}
}
setwd("~/Documents/UZH_icloud/tutorial_project/ecological_network_tools/weboflife")
rm(list=ls())
library(weboflife)
library(weboflife)
get_networks(networkName="M_SD_002", data_type = "all")
get_networks(networkName="M_SD_002", interaction_type = "pollination", data_type = "all")
setwd("~/Documents/UZH_icloud/tutorial_project/test_PL_62")
source("get_networks.R")
get_networks <- function(networkName, interaction_type, data_type, names = "yes"){
# would you like to include the names of the species? ("yes" or "no")
speciesName <- names
if (missing(networkName)){
# create an empty list to store the networks
network_list <- list()
# nested ifelse statement to turn interaction types into codes for Web of Life
type_id <- ifelse(interaction_type == "plant-ant", "3",
ifelse(interaction_type == "pollination", "5",
ifelse(interaction_type == "seed disperser", "6",
ifelse(interaction_type == "anemone-fish", "11",
ifelse(interaction_type == "host-parasite", "8",
ifelse(interaction_type == "plant-herbivore", "10",
ifelse(interaction_type == "food web", "7",
ifelse(interaction_type == "all", "All", NA))))))))
data_id <- ifelse(data_type == "binary", "0",
ifelse(data_type == "weighted", "1",
ifelse(data_type == "all", "All", NA)))
# create a file (json_networks) with the names of the networks we would like to download
json_file <- paste("http://www.web-of-life.es/networkslist.php?type=",
type_id, "&data=", data_id, sep = "")
json_networks <- rjson::fromJSON(file = json_file) #rjson::fromJSON(paste(readLines(json_file), collapse = ""))
# download the networks
#network_list <- list()
for(i in 1: length(json_networks)){
# identifying the network
#if(as.numeric(json_networks[[i]]$countSpecies) > 0) { # we get networks and subnetworks
if(json_networks[[i]]$root == 0 & is.null(json_networks[[i]]$parentNetworkId)){ # we get networks without subnetworks
networkName <- json_networks[[i]]$networkName
print(networkName)
# building the URL
url <- paste("http://www.web-of-life.es/download/",
networkName,
"_",
speciesName, ".csv",
sep = "")
# download the network from www.web-of-life.es
data <- data.table::fread(url)
# storing the networks as a data table
assign(networkName, data)
# storing the networks as a list
network_list[[networkName]] <- (data)
}
#}
}
return(network_list)
}
else  # networkName passed as an argument
{
url <- paste("http://www.web-of-life.es/download/",
networkName,
"_",
speciesName,
".csv",
sep = "")
# download the requested network from www.web-of-life.es
data <- data.table::fread(url)
return (data)
}
}
get_networks(networkName="M_SD_002", interaction_type = "pollination", data_type = "all")
get_networks(networkName="M_SD_002",  data_type = "all")
networks <- get_networks(interaction_type = "pollination")
source("get_networks.R")
source("get_networks.R")
networks <- get_networks(interaction_type = "pollination")
length(networks)
networks <- get_networks()
length(networks)
networks <- get_networks(data_type = "0")
networks <- get_networks(data_type = "binary")
length(networks)
networks <- get_networks(data_type = "weighted")
length(networks)
rm(list=ls())
remove.packages("weboflife")
library(weboflife)
library(weboflife)
networks <- get_networks(data_type = "binary")
?get_networks
setwd("~/Documents/UZH_icloud/tutorial_project/weboflife")
setwd("~/Documents/UZH_icloud/tutorial_project/test_PL_62")
source("get_networks.R")
networks <- get_networks(interaction_type = "pollination")
rm(list=ls())
setwd("~/Documents/UZH_icloud/tutorial_project/weboflife")
remove.packages("weboflife")
